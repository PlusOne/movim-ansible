{{ domain_name }} {
    encode zstd gzip

    @static path /stickers/* /cache/* /theme/* /scripts/*.js

    handle @static {
        root * {{ movim_dir }}/public
        file_server
    }

    handle {
        rewrite * /index.php?{query}
        reverse_proxy unix//run/php/php-fpm.sock {
            transport fastcgi {
                env SCRIPT_FILENAME {{ movim_dir }}/public/index.php
            }
        }
    }

    handle /ws/* {
        # This part of the configuration is generated when launching the daemon in the console output
    }

    header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    header X-XSS-Protection "1; mode=block"
    header X-Content-Type-Options "nosniff"
    header X-Frame-Options "DENY"
    header -Server
    header / {
        Content-Security-Policy = "upgrade-insecure-requests; default-src 'self'; style-src 'self'; script-src 'self'; img-src 'self'; object-src 'self'; worker-src 'self'; manifest-src 'self';"
        Referrer-Policy = "strict-origin-when-cross-origin"
        Permissions-Policy = "fullscreen=(self)"
        cache-control = "max-age=0,no-cache,no-store,must-revalidate"
        X-Robots-Tag "noindex, nofollow, noarchive, nosnippet, notranslate, noimageindex"
    }
}